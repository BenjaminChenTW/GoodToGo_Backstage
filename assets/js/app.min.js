function appInit(i){var o=!1,s=null,r=(i.location.hash||"#index").replace("#","");$("#"+r).get(0)||(r=index);var u=null,c={shop:"店鋪",user:"使用者",container:"容器"},t=function(t,e){switch(isNaN(t)&&(t=0),e){case"withArrow":return"("+(0<=t?'<i class="material-icons" role="presentation">arrow_upward</i>':'<i class="material-icons" role="presentation">arrow_downward</i>')+parseFloat(100*Math.abs(t)).toFixed(1)+"%)";case"withoutParentheses":return parseFloat(100*t).toFixed(1)+"%";default:return"("+parseFloat(100*t).toFixed(1)+"%)"}},e=function(t){return a.searchRegExp?"user"===r?t.id.match(a.searchRegExp):"shop"===r?t.storeName.match(a.searchRegExp):void 0:t},l=function(){$(".searchbar-field .mdl-textfield__input").val("").parent().removeClass("is-focused").removeClass("is-dirty").blur(),a.search.txt=""},a=new Vue({el:"#app",mounted:function(){this[r].show=!0},filters:{numberWithCommas:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},numberToPercentage:t,durationToString:function(t){return isNaN(t)?t:(e=moment.duration(t),n="",o=function(t,e){n+=(2==++a?" ":"")+t+" "+e},(a=0)!==e.get("Y")&&o(e.get("Y"),"年"),0!==e.get("M")&&o(e.get("M"),"個月"),2==a||(0!==e.get("d")&&o(e.get("d"),"天"),2==a||(0!==e.get("h")&&o(e.get("h"),"小時"),2==a||(0!==e.get("m")&&o(e.get("m"),"分鐘"),""===n&&(n+="0")))),n);var e,a,n,o},dateToString:function(t,e){if("尚未歸還"===t)return t;var a=moment(t);if(!a.isValid())return t;switch(e){case"only_date":return a.format("YYYY-MM-DD");case"with_day":return a.format("YYYY-MM-DD (ddd) HH:mm");default:return a.format("YYYY-MM-DD HH:mm")}}},updated:function(){o&&(componentHandler.upgradeDom(),o=!1),this.dynamicLoading.rawCapacity=function(t){var e=$("#"+t).find("tbody").get(0);if(e){var a=e.getBoundingClientRect(),n="user-detail"!==t?48:65,o=Math.floor((i.innerHeight-a.top-44)/n);return 5<o?o:5}}(r+(this.detailIsOpen?"-detail":""))},methods:{navClickListener:function(e){var a=this;(s||r+"Detail"in this)&&(this[s||r+"Detail"].show=!1),l(),$(".mdl-layout__obfuscator.is-visible").click(),requestData(e,function(t){a[r].show=!1,a[e].show=!0,test||(a[e].data=t),u=null,a.dynamicLoading.baseIndex=1,r=e,o=!0,a.search.placeholder=c[r]?"在「"+c[r]+"」中搜尋":"搜尋",$("main").scrollTop(0)})},aRecordClickListener:function(t,e){var a=this,n=t+"Detail";requestData(n+"?id="+e,function(t){s&&(a[s].show=!1),a[n].show=!0,s=n,test||(a[s].data=t),u=a.dynamicLoading.baseIndex,a.dynamicLoading.baseIndex=1,l(),$("main").scrollTop(0)})},closeDetail:function(){l(),this[s||r+"Detail"].show=!1,this[s||r+"Detail"].data.history=[],s=null,this.dynamicLoading.baseIndex=u||1},flipPage:function(t){var e;e=this.detailIsOpen?this[r+"Detail"].data.history.length:this[r].data.list.length;var a=Math.ceil(e/this.dynamicLoading.rawCapacity);switch(t){case"next":this.dynamicLoading.baseIndex=Math.min(this.dynamicLoading.baseIndex+1,a);break;case"last":this.dynamicLoading.baseIndex=Math.max(this.dynamicLoading.baseIndex-1,1)}},searchData:function(){var e=this,t=this.search.txt;if(!(t.length<1)){var a="search?txt="+t;if("index"===r)a+="&fields=shop,user,container";else{if("container"!==r)return;a+="&fields=container"}requestData(a,function(t){e[s="search"].show=!0,test||(e[s].data=t),$("main").scrollTop(0)})}},aSearchResultClickListener:function(e,t){var a=this,n=e+"Detail";-1!==t&&requestData(n+"?id="+t,function(t){s&&(a[s].show=!1),a[r].show=!1,a[e].show=!0,r=e,u=null,a.dynamicLoading.baseIndex=1,o=!0,a.search.placeholder=c[r]?"在「"+c[r]+"」中搜尋":"搜尋",a[n].show=!0,s=n,test||(a[s].data=t),l(),$("main").scrollTop(0),test||requestData(e,function(t){a[e].data=t},{daemon:!0})})},listMatchCtx:function(t){return this.searchRegExp?t.replace(this.searchRegExp,"<strong>$&</strong>"):t},numberToPercentage:t},computed:{detailIsOpen:function(){return this.search.show||this.shopDetail.show||this.userDetail.show||this.containerDetail.show||this.deliveryDetail.show},searchRegExp:function(){if(!(0<this.search.txt.length))return null;this.dynamicLoading.baseIndex=1;var t=this.search.txt.split(" ").filter(function(t){return""!==t});t.forEach(function(t,e,a){1<t.length&&(a[e]=t.split("").join("-*"))});var e=t.join("|");try{return new RegExp(e,"gi")}catch(t){return null}},shopList:function(){return this.shop.data.list.filter(e)},userList:function(){return this.user.data.list.filter(e)}},data:{loading:{show:!1,txt:"載入中..."},dynamicLoading:{baseIndex:1,rawCapacity:0},index:{show:!1,data:{summary:{userAmount:824,storeAmount:18,activityAmount:62},activityHistorySummary:{usedAmount:16774,lostAmount:135,totalDuration:12314},shopHistorySummary:{usedAmount:6487,lostAmount:248,totalDuration:57563433659,quantityOfBorrowingFromDiffPlace:796},shopRecentHistorySummary:{usedAmount:87,lostAmount:3,totalDuration:111013967,quantityOfBorrowingFromDiffPlace:23}}},search:{show:!1,txt:"",placeholder:"搜尋",data:{user:{show:!0,list:[{id:"0936033091",name:"0936-033-091"}]},container:{show:!0,list:[{id:17,name:"#017　16oz 杯子",type:0}]},shop:{show:!0,list:[{id:0,name:"布萊恩紅茶"}]},delivery:{show:!0,list:[]}}},shop:{show:!1,data:{list:[{id:0,storeName:"店名",toUsedAmount:0,todayAmount:0,weekAmount:0,weekAverage:0}]}},shopDetail:{show:!1,expand:!1,data:{storeName:"布萊恩紅茶",toUsedAmount:24,todayAmount:2,weekAmount:18,recentAmount:18,joinedDate:1234,contactNickname:"店長",contactPhone:"0988555666",recentAmountPercentage:.16,weekAverage:10,history:[{time:1234,serial:"#161",action:"借出",owner:"0911-***-521",by:"布萊恩紅茶(阿呆店長)"}]}},activity:{show:!1},user:{show:!1,data:{totalUserAmount:0,totalUsageAmount:0,weeklyAverageUsage:0,totalLostAmount:0,list:[{id:"",phone:"0912-345-678",usingAmount:0,lostAmount:0,totalUsageAmount:0}]}},userDetail:{show:!1,expand:!1,data:{userPhone:"0936-003-091",usingAmount:3,lostAmount:23,totalUsageAmount:200,joinedDate:1234,joinedMethod:"店鋪 (方糖咖啡)",recentAmount:18,recentAmountPercentage:.16,weekAverage:10,averageUsingDuration:12e5,amountOfBorrowingFromDiffPlace:43,history:[{containerType:"12oz 玻璃杯",containerID:"#101",rentTime:1234,rentPlace:"布萊恩紅茶",returnTime:1234,returnPlace:"布萊恩紅茶",usingDuration:1234}]}},container:{show:!1,data:{list:[{id:0,type:"類別",totalAmount:0,toUsedAmount:0,usingAmount:0,returnedAmount:0,toCleanAmount:0,toDeliveryAmount:0,toSignAmount:0,inStorageAmount:0,lostAmount:0}]}},containerDetail:{show:!1,expand:!1,data:{containerID:"#257",containerType:{txt:"16oz 玻璃杯",code:1},reuseTime:24,status:"使用中",bindedUser:"0921-**-931",joinedDate:1234,history:[{tradeTime:1234,action:"借出",newUser:"0921-***-931",oriUser:"特有種商行(小衛)",comment:""}]}},delivery:{show:!1},deliveryDetail:{show:!1,expand:!1}}});(i.app=a).navClickListener(r)}!function(i){var s=null;function n(t,n,e){s&&s.abort(),e||(e={});var o=e.daemon||!1;o||r();var a="/manager/data/"+t;console.log(a),s=$.ajax(a,{headers:{Accept:"application/json; charset=utf-8"},dataType:"json"}).done(function(t,e,a){o||u(),n(t)}).fail(function(t,e,a){if(t.responseJSON&&"B005"===t.responseJSON.code)return i.location.href=$("#logout").attr("href");var n;o||u(),"abort"!==t.statusText&&(n="["+t.status+"]: "+(t.responseJSON?t.responseJSON.message:t.statusText||"Unknown ERR"),document.querySelector("#toast").MaterialSnackbar.showSnackbar({message:n,timeout:4e3}))}).always(function(){s=null})}function r(){app.loading.txt="Loading...",app.loading.show=!0}function u(){app.loading.show=!1,app.loading.txt=""}i.test=!1,i.requestData=function(t,e,a){return i.test?function(t,e,a){s&&clearTimeout(s),r();var n="/manager/data/"+t;console.log(n),s=setTimeout(function(){s=null,u(),e()},500)}(t,e):n(t,e,a)}}(window),$(window).on("load",function(){"/manager/login"!==window.location.pathname&&($("#loading_main").css("display","none"),appInit(window))});
//# sourceMappingURL=source-maps/app.min.js.map
