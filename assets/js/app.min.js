function debounce(n,i){var o=null;return function(){var t=this,e=arguments;clearTimeout(o),o=setTimeout(function(){n.apply(t,e)},i)}}function appInit(r){var n=null,o=null,i={shop:"店鋪",user:"使用者",container:"容器"},s='<i class="material-icons" role="presentation">arrow_upward</i>',a='<i class="material-icons" role="presentation">arrow_downward</i>',l='<i class="material-icons" role="presentation">arrow_drop_down</i>',u='<i class="material-icons" role="presentation">arrow_drop_up</i>',t=function(t,e){switch(isNaN(t)&&(t=0),e){case"withArrow":return"("+(0<=t?s:a)+parseFloat(100*Math.abs(t)).toFixed(1)+"%)";case"withoutParentheses":return parseFloat(100*t).toFixed(1)+"%";default:return"("+parseFloat(100*t).toFixed(1)+"%)"}},e=function(t){var e=$("#"+t).find("tbody").get(0);if(e){var n,i=e.getBoundingClientRect();switch(t){case"user-detail":n=65;break;case"delivery":n=56;break;default:n=48}var o=Math.floor((r.innerHeight-i.top-44-$("main").scrollTop())/n);return 5<o?o:5}},c=function(){if(null!==w.showed){if("shopDetail"===w.showed)return y.shopDetailHistory.length;if("userDetail"===w.showed)return y.userDetailHistory.length;if("containerDetail"===w.showed)return y.containerDetailHistory.length}else{if("shop"===m.active)return y.shopList.length;if("user"===m.active)return y.userList.length;if("container"===m.active)return y.container.data.list.length}return-1},d=function(t){return y.searchRegExp?"user"===m.active?t.id.match(y.searchRegExp):"shop"===m.active?t.storeName.match(y.searchRegExp):void 0:t},h={get:function(t){return this[t]?this[t]:this.number},string:function(t,e){if(t=t[y.listRendering.keyToSort].toLowerCase(),e=e[y.listRendering.keyToSort].toLowerCase(),y.listRendering.sortDir){if(t<e)return 1;if(e<t)return-1}else{if(t<e)return-1;if(e<t)return 1}return 0},number:function(t,e){return y.listRendering.sortDir?e[y.listRendering.keyToSort]-t[y.listRendering.keyToSort]:t[y.listRendering.keyToSort]-e[y.listRendering.keyToSort]},numberString:function(t,e){try{return t=parseInt(t[y.listRendering.keyToSort]),e=parseInt(e[y.listRendering.keyToSort]),y.listRendering.sortDir?e-t:t-e}catch(t){return 1}},serial:function(t,e){return t=parseInt(t[y.listRendering.keyToSort].slice(1)),e=parseInt(e[y.listRendering.keyToSort].slice(1)),y.listRendering.sortDir?e-t:t-e},time:function(t,e){return t=new Date(t[y.listRendering.keyToSort]),e=new Date(e[y.listRendering.keyToSort]),y.listRendering.sortDir?e-t:t-e}},f=function(){if(y.detailIsOpen){var t=w.showed.slice(0,w.showed.indexOf("Detail"))+"-detail";e=$("#"+t+" .table-page-switcher")}else var e=$(".table-page-switcher");e.length&&(e.focus(),e.off("keyup"),e.keyup(function(t){"ArrowLeft"===t.key?y.flipPage("last"):"ArrowRight"===t.key&&y.flipPage("next")}))},g=function(){$(".searchbar-field .mdl-textfield__input").val("").parent().removeClass("is-focused").removeClass("is-dirty"),y.search.txt=""},p=function(t){var e={baseIndex:1,sortDir:null,keyToSort:null};t&&Object.assign(e,t),Object.assign(y.listRendering,e),n=null},m={showed:null,get active(){return this.showed},open:function(e,t,n){e in y&&(null!==this.showed&&this.close(),y[e].show=!0,o=null,p(),y.search.placeholder=i[e]?"在「"+i[e]+"」中搜尋":"搜尋",n?test||requestData(e,function(t){y[e].data=t},{daemon:!0}):($("main").scrollTop(0),test||(y[e].data=t),y.$nextTick(function(){componentHandler.upgradeDom(),f()})),this.showed=e)},close:function(){var t=this.showed;null!==t&&(y[t].show=!1,this.showed=null)}},w={showed:null,open:function(t,e){t in y&&(null!==this.showed&&this.close(),y[t].show=!0,test||(y[t].data=e),"search"===t?y.$nextTick(function(){componentHandler.upgradeDom(),f()}):y.$nextTick(function(){setTimeout(function(){componentHandler.upgradeDom(),f()},600)}),this.showed=t,$("main").scrollTop(0))},close:function(){var t=this.showed;if(null!==t){if("search"===t){for(var e in y.search.data)y.search.data[e].list=[];y.search.show=!1}else y[t].data.history=[],y[t].show=!1;this.showed=null,y.$nextTick(function(){setTimeout(function(){f()},600)})}}},y=new Vue({el:"#app",mounted:function(){var t=this;$(r).resize(debounce(function(){$("table").length&&(t.listRendering.rawCapacity=e(m.active+(t.detailIsOpen?"-detail":"")),t.listRendering.dataLength=c(),t.$nextTick(function(){componentHandler.upgradeDom()}))},500))},updated:function(){this.listRendering.rawCapacity=e(m.active+(this.detailIsOpen?"-detail":"")),this.listRendering.dataLength=c(),this.$nextTick(function(){componentHandler.upgradeDom()})},filters:{numberWithCommas:function(t){return"number"!=typeof t?"0":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},numberToPercentage:t,durationToString:function(t){return isNaN(t)?t:(e=moment.duration(t),i="",o=function(t,e){i+=(2==++n?" ":"")+t+" "+e},(n=0)!==e.get("Y")&&o(e.get("Y"),"年"),0!==e.get("M")&&o(e.get("M"),"個月"),2==n||(0!==e.get("d")&&o(e.get("d"),"天"),2==n||(0!==e.get("h")&&o(e.get("h"),"小時"),2==n||(0!==e.get("m")&&o(e.get("m"),"分鐘"),""===i&&(i+="0")))),i);var e,n,i,o},dateToString:function(t,e){if("尚未歸還"===t)return t;var n=moment(t);if(!n.isValid())return t;switch(e){case"only_date":return n.format("YYYY-MM-DD");case"with_day":return n.format("YYYY-MM-DD (ddd) HH:mm");default:return n.format("YYYY-MM-DD HH:mm")}}},methods:{navClickListener:function(e){g(),$(".mdl-layout__obfuscator.is-visible").click(),requestData(e,function(t){w.close(),m.open(e,t)})},aRecordClickListener:function(t,e){var n=this,i=t+"Detail";requestData(i+"?id="+e,function(t){w.open(i,t),o=n.listRendering.baseIndex,g(),p()})},aRefreshButtonClickListener:function(t){requestData("refresh/"+t,function(t){"object"==typeof t&&(t="Done"),r.showToast(t)},{method:"PATCH"})},closeDetail:function(){w.close(),g(),p({baseIndex:o||1})},searchData:function(){var t=this.search.txt;if(!(t.length<1)){var e="search?txt="+t;if("index"===m.active)e+="&fields=shop,user,container";else{if("container"!==m.active)return;e+="&fields=container"}requestData(e,function(t){w.open("search",t)})}},aSearchResultClickListener:function(e,t){var n=e+"Detail";-1!==t&&requestData(n+"?id="+t,function(t){w.open(n,t),m.open(e,t,!0),g()})},sortList:function(t,e){null==this.listRendering.sortDir?this.listRendering.sortDir=!0:t===this.listRendering.keyToSort&&(this.listRendering.sortDir=!this.listRendering.sortDir),this.listRendering.keyToSort=t,n=void 0===e?"number":e,this.listRendering.baseIndex=1},showKeySorting:function(t,e){return e===this.listRendering.keyToSort&&(t+=this.listRendering.sortDir?l:u),t},flipPage:function(t){var e;e=this.detailIsOpen?this[m.active+"Detail"].data.history.length:this[m.active+"List"].length;var n=Math.ceil(e/this.listRendering.rawCapacity);switch(t){case"next":this.listRendering.baseIndex=Math.min(this.listRendering.baseIndex+1,n);break;case"last":this.listRendering.baseIndex=Math.max(this.listRendering.baseIndex-1,1)}},listMatchCtx:function(t){return this.searchRegExp?t.replace(this.searchRegExp,"<strong>$&</strong>"):t},numberToPercentage:t,openDialog:function(){return r.dialog.showModal()}},computed:{detailIsOpen:function(){return this.search.show||this.shopDetail.show||this.userDetail.show||this.containerDetail.show},searchRegExp:function(){if(!(0<this.search.txt.length))return null;this.listRendering.baseIndex=1;var t=this.search.txt.split(" ").filter(function(t){return""!==t});t.forEach(function(t,e,n){1<t.length&&(n[e]=t.split("").join("-*"))});var e=t.join("|");try{return new RegExp(e,"gi")}catch(t){return null}},shopList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.shop.data.list.filter(d):this.shop.data.list.filter(d).sort(h.get(n))},shopDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.shopDetail.data.history.sort(h.get(n)):this.shopDetail.data.history},userList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.user.data.list.filter(d):this.user.data.list.filter(d).sort(h.get(n))},userDetailHistory:function(){if(null!==this.listRendering.keyToSort&&this.detailIsOpen){var t=this.userDetail.data.history.map(function(t){return t.returnTime}).lastIndexOf("尚未歸還")+1;return"returnTime"!==this.listRendering.keyToSort?this.userDetail.data.history.slice(0,t).sort(h.get(n)).concat(this.userDetail.data.history.slice(t).sort(h.get(n))):this.userDetail.data.history.slice(0,t).concat(this.userDetail.data.history.slice(t).sort(h.get(n)))}return this.userDetail.data.history},containerDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.containerDetail.data.history.sort(h.get(n)):this.containerDetail.data.history}},data:{loading:{show:!1,txt:"載入中..."},listRendering:{baseIndex:1,rawCapacity:1,dataLength:-1,keyToSort:null,sortDir:null},index:{show:!1,data:{summary:{userAmount:824,storeAmount:18,activityAmount:62},activityHistorySummary:{usedAmount:16774,lostAmount:135,totalDuration:12314},shopRecentHistorySummary:{usedAmount:87,customerLostAmount:3,totalDuration:111013967,quantityOfBorrowingFromDiffPlace:23},shopHistorySummary:{usedAmount:6487,shopLostAmount:248,customerLostAmount:248,totalDuration:57563433659,quantityOfBorrowingFromDiffPlace:796}}},search:{show:!1,txt:"",placeholder:"搜尋",data:{user:{show:!0,list:[{id:"0936033091",name:"0936-033-091"}]},container:{show:!0,list:[{id:17,name:"#017　16oz 杯子",type:0}]},shop:{show:!0,list:[{id:0,name:"布萊恩紅茶"}]},delivery:{show:!0,list:[]}}},shop:{show:!1,data:{list:[]}},shopDetail:{show:!1,expand:!1,data:{storeName:"布萊恩紅茶",toUsedAmount:24,todayAmount:2,weekAmount:18,recentAmount:18,joinedDate:1234,contactNickname:"店長",contactPhone:"0988555666",recentAmountPercentage:.16,weekAverage:10,history:[]}},activity:{show:!1},user:{show:!1,data:{totalUserAmount:0,totalUsageAmount:0,weeklyAverageUsage:0,totalLostAmount:0,list:[]}},userDetail:{show:!1,expand:!1,data:{userPhone:"0936-003-091",usingAmount:3,lostAmount:23,totalUsageAmount:200,joinedDate:1234,joinedMethod:"店鋪 (方糖咖啡)",recentAmount:18,recentAmountPercentage:.16,weekAverage:10,averageUsingDuration:12e5,amountOfBorrowingFromDiffPlace:43,history:[]}},container:{show:!1,data:{list:[]}},containerDetail:{show:!1,expand:!1,data:{containerID:"#257",containerType:{txt:"16oz 玻璃杯",code:1},reuseTime:24,status:"使用中",bindedUser:"0921-**-931",joinedDate:1234,history:[]}},delivery:{show:!1},console:{show:!1,data:null}}});r.app=y,m.showed=(r.location.hash||"#index").replace("#",""),m.showed in y||(m.showed="index"),y.navClickListener(m.active)}!function(s){var a=null;function l(){app.loading.txt="Loading...",app.loading.show=!0}function u(){app.loading.show=!1,app.loading.txt=""}function c(t){document.querySelector("#toast").MaterialSnackbar.showSnackbar({message:t,timeout:4e3})}s.test=!1,s.requestData=function(t,e,n){return s.test?(i=e,a&&clearTimeout(a),l(),void(a=setTimeout(function(){a=null,u(),i()},500))):function(t,i,e){a&&a.abort(),e||(e={});var o=e.daemon||!1,n=e.method||"GET";o||l();var r="/manager/data/"+t;a=$.ajax(r,{headers:{Accept:"application/json; charset=utf-8"},dataType:"json",method:n}).done(function(t,e,n){o||u(),i(t)}).fail(function(t,e,n){if(t.responseJSON&&"B005"===t.responseJSON.code)return s.location.href=$("#logout").attr("href");if(o||u(),"abort"!==t.statusText){var i=t.responseJSON?t.responseJSON.message:t.statusText||"Unknown ERR";c("["+t.status+"]: "+i)}}).always(function(){a=null})}(t,e,n);var i},s.showToast=c}(window),$(window).on("load",function(){"/manager/login"!==window.location.pathname&&($("#loading_main").css("display","none"),appInit(window));var t=document.querySelector("dialog");t.showModal||dialogPolyfill.registerDialog(t),t.querySelector(".close").addEventListener("click",function(){t.close()}),window.dialog=t});
//# sourceMappingURL=source-maps/app.min.js.map
