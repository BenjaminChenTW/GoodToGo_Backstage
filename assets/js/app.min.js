function debounce(n,i){var r=null;return function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout(function(){n.apply(t,e)},i)}}function appInit(o){var s=!1,a=null,l=(o.location.hash||"#index").replace("#","");$("#"+l).get(0)||(l=index);var u=null,d={shop:"店鋪",user:"使用者",container:"容器"},n=null,t=function(t,e){switch(isNaN(t)&&(t=0),e){case"withArrow":return"("+(0<=t?'<i class="material-icons" role="presentation">arrow_upward</i>':'<i class="material-icons" role="presentation">arrow_downward</i>')+parseFloat(100*Math.abs(t)).toFixed(1)+"%)";case"withoutParentheses":return parseFloat(100*t).toFixed(1)+"%";default:return"("+parseFloat(100*t).toFixed(1)+"%)"}},e=function(t){var e=$("#"+t).find("tbody").get(0);if(e){var n=e.getBoundingClientRect(),i="user-detail"!==t?48:65,r=Math.floor((o.innerHeight-n.top-44)/i);return 5<r?r:5}},i=function(t){return g.searchRegExp?"user"===l?t.id.match(g.searchRegExp):"shop"===l?t.storeName.match(g.searchRegExp):void 0:t},r={get:function(t){return this[t]?this[t]:this.number},string:function(t,e){if(t=t[g.listRendering.keyToSort].toLowerCase(),e=e[g.listRendering.keyToSort].toLowerCase(),g.listRendering.sortDir){if(t<e)return 1;if(e<t)return-1}else{if(t<e)return-1;if(e<t)return 1}return 0},number:function(t,e){return g.listRendering.sortDir?e[g.listRendering.keyToSort]-t[g.listRendering.keyToSort]:t[g.listRendering.keyToSort]-e[g.listRendering.keyToSort]},numberString:function(t,e){try{return t=parseInt(t[g.listRendering.keyToSort]),e=parseInt(e[g.listRendering.keyToSort]),g.listRendering.sortDir?e-t:t-e}catch(t){return 1}},serial:function(t,e){return t=parseInt(t[g.listRendering.keyToSort].slice(1)),e=parseInt(e[g.listRendering.keyToSort].slice(1)),g.listRendering.sortDir?e-t:t-e},time:function(t,e){return t=new Date(t[g.listRendering.keyToSort]),e=new Date(e[g.listRendering.keyToSort]),g.listRendering.sortDir?e-t:t-e}},c=function(){$(".searchbar-field .mdl-textfield__input").val("").blur().parent().removeClass("is-focused").removeClass("is-dirty"),g.search.txt=""},h=function(t){t.listRendering.baseIndex=1,t.listRendering.sortDir=null,t.listRendering.keyToSort=null,n=null},g=new Vue({el:"#app",mounted:function(){this[l].show=!0;var t=this;$(o).resize(debounce(function(){console.log("resize"),$("#"+l).find(".table-page-switcher").length&&(t.listRendering.rawCapacity=e(l+(t.detailIsOpen?"-detail":"")))},500))},filters:{numberWithCommas:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},numberToPercentage:t,durationToString:function(t){return isNaN(t)?t:(e=moment.duration(t),i="",r=function(t,e){i+=(2==++n?" ":"")+t+" "+e},(n=0)!==e.get("Y")&&r(e.get("Y"),"年"),0!==e.get("M")&&r(e.get("M"),"個月"),2==n||(0!==e.get("d")&&r(e.get("d"),"天"),2==n||(0!==e.get("h")&&r(e.get("h"),"小時"),2==n||(0!==e.get("m")&&r(e.get("m"),"分鐘"),""===i&&(i+="0")))),i);var e,n,i,r},dateToString:function(t,e){if("尚未歸還"===t)return t;var n=moment(t);if(!n.isValid())return t;switch(e){case"only_date":return n.format("YYYY-MM-DD");case"with_day":return n.format("YYYY-MM-DD (ddd) HH:mm");default:return n.format("YYYY-MM-DD HH:mm")}}},updated:function(){var t;s&&(componentHandler.upgradeDom(),(t=$("#"+l).find(".table-page-switcher")).length?(t.get(0).focus(),t.each(function(){$(this).keyup(function(t){"ArrowLeft"===t.key?g.flipPage("last"):"ArrowRight"===t.key&&g.flipPage("next")})})):$(o).off("resize"),s=!1),this.listRendering.rawCapacity=e(l+(this.detailIsOpen?"-detail":""))},methods:{navClickListener:function(e){var n=this;(a||l+"Detail"in this)&&(this[a||l+"Detail"].show=!1),c(),$(".mdl-layout__obfuscator.is-visible").click(),requestData(e,function(t){n[l].show=!1,n[e].show=!0,test||(n[e].data=t),u=null,h(n),l=e,s=!0,n.search.placeholder=d[l]?"在「"+d[l]+"」中搜尋":"搜尋",$("main").scrollTop(0)})},aRecordClickListener:function(t,e){var n=this,i=t+"Detail";requestData(i+"?id="+e,function(t){a&&(n[a].show=!1),n[i].show=!0,a=i,test||(n[a].data=t),u=n.listRendering.baseIndex,h(n),c(),$("main").scrollTop(0)})},closeDetail:function(){c(),this[a||l+"Detail"].show=!1,this[a||l+"Detail"].data.history=[],a=null,this.listRendering.baseIndex=u||1},sortList:function(t,e){c(),null==this.listRendering.sortDir?this.listRendering.sortDir=!0:t===this.listRendering.keyToSort&&(this.listRendering.sortDir=!this.listRendering.sortDir),this.listRendering.keyToSort=t,n=void 0===e?"number":e},showKeySorting:function(t,e){return e===this.listRendering.keyToSort&&(t+=this.listRendering.sortDir?'<i class="material-icons" role="presentation">arrow_drop_down</i>':'<i class="material-icons" role="presentation">arrow_drop_up</i>'),t},flipPage:function(t){var e;e=this.detailIsOpen?this[l+"Detail"].data.history.length:this[l+"List"].length;var n=Math.ceil(e/this.listRendering.rawCapacity);switch(t){case"next":this.listRendering.baseIndex=Math.min(this.listRendering.baseIndex+1,n);break;case"last":this.listRendering.baseIndex=Math.max(this.listRendering.baseIndex-1,1)}},searchData:function(){var e=this,t=this.search.txt;if(!(t.length<1)){var n="search?txt="+t;if("index"===l)n+="&fields=shop,user,container";else{if("container"!==l)return;n+="&fields=container"}requestData(n,function(t){e[a="search"].show=!0,test||(e[a].data=t),$("main").scrollTop(0)})}},aSearchResultClickListener:function(n,t){var i=this,r=n+"Detail";-1!==t&&requestData(r+"?id="+t,function(t){for(var e in i.search.show=!1,i.search.data)i.search.data[e].list=[];i[l].show=!1,i[n].show=!0,l=n,u=null,h(i),s=!0,i.search.placeholder=d[l]?"在「"+d[l]+"」中搜尋":"搜尋",i[r].show=!0,a=r,test||(i[a].data=t),c(),$("main").scrollTop(0),test||requestData(n,function(t){i[n].data=t},{daemon:!0})})},listMatchCtx:function(t){return this.searchRegExp?t.replace(this.searchRegExp,"<strong>$&</strong>"):t},numberToPercentage:t},computed:{detailIsOpen:function(){return this.search.show||this.shopDetail.show||this.userDetail.show||this.containerDetail.show||this.deliveryDetail.show},searchRegExp:function(){if(!(0<this.search.txt.length))return null;this.listRendering.baseIndex=1;var t=this.search.txt.split(" ").filter(function(t){return""!==t});t.forEach(function(t,e,n){1<t.length&&(n[e]=t.split("").join("-*"))});var e=t.join("|");try{return new RegExp(e,"gi")}catch(t){return null}},shopList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.shop.data.list.filter(i):this.shop.data.list.filter(i).sort(r.get(n))},shopDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.shopDetail.data.history.sort(r.get(n)):this.shopDetail.data.history},userList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.user.data.list.filter(i):this.user.data.list.filter(i).sort(r.get(n))},userDetailHistory:function(){if(null!==this.listRendering.keyToSort&&this.detailIsOpen){var t=this.userDetail.data.history.map(function(t){return t.returnTime}).lastIndexOf("尚未歸還")+1;return"returnTime"!==this.listRendering.keyToSort?this.userDetail.data.history.slice(0,t).sort(r.get(n)).concat(this.userDetail.data.history.slice(t).sort(r.get(n))):this.userDetail.data.history.slice(0,t).concat(this.userDetail.data.history.slice(t).sort(r.get(n)))}return this.userDetail.data.history},containerDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.containerDetail.data.history.sort(r.get(n)):this.containerDetail.data.history}},data:{loading:{show:!1,txt:"載入中..."},listRendering:{baseIndex:1,rawCapacity:0,keyToSort:null,sortDir:null},index:{show:!1,data:{summary:{userAmount:824,storeAmount:18,activityAmount:62},activityHistorySummary:{usedAmount:16774,lostAmount:135,totalDuration:12314},shopHistorySummary:{usedAmount:6487,lostAmount:248,totalDuration:57563433659,quantityOfBorrowingFromDiffPlace:796},shopRecentHistorySummary:{usedAmount:87,lostAmount:3,totalDuration:111013967,quantityOfBorrowingFromDiffPlace:23}}},search:{show:!1,txt:"",placeholder:"搜尋",data:{user:{show:!0,list:[{id:"0936033091",name:"0936-033-091"}]},container:{show:!0,list:[{id:17,name:"#017　16oz 杯子",type:0}]},shop:{show:!0,list:[{id:0,name:"布萊恩紅茶"}]},delivery:{show:!0,list:[]}}},shop:{show:!1,data:{list:[{id:0,storeName:"店名",toUsedAmount:0,todayAmount:0,weekAmount:0,weekAverage:0}]}},shopDetail:{show:!1,expand:!1,data:{storeName:"布萊恩紅茶",toUsedAmount:24,todayAmount:2,weekAmount:18,recentAmount:18,joinedDate:1234,contactNickname:"店長",contactPhone:"0988555666",recentAmountPercentage:.16,weekAverage:10,history:[{time:1234,serial:"#161",action:"借出",owner:"0911-***-521",by:"布萊恩紅茶(阿呆店長)"}]}},activity:{show:!1},user:{show:!1,data:{totalUserAmount:0,totalUsageAmount:0,weeklyAverageUsage:0,totalLostAmount:0,list:[{id:"",phone:"0912-345-678",usingAmount:0,lostAmount:0,totalUsageAmount:0}]}},userDetail:{show:!1,expand:!1,data:{userPhone:"0936-003-091",usingAmount:3,lostAmount:23,totalUsageAmount:200,joinedDate:1234,joinedMethod:"店鋪 (方糖咖啡)",recentAmount:18,recentAmountPercentage:.16,weekAverage:10,averageUsingDuration:12e5,amountOfBorrowingFromDiffPlace:43,history:[{containerType:"12oz 玻璃杯",containerID:"#101",rentTime:1234,rentPlace:"布萊恩紅茶",returnTime:1234,returnPlace:"布萊恩紅茶",usingDuration:1234}]}},container:{show:!1,data:{list:[{id:0,type:"類別",totalAmount:0,toUsedAmount:0,usingAmount:0,returnedAmount:0,toCleanAmount:0,toDeliveryAmount:0,toSignAmount:0,inStorageAmount:0,lostAmount:0}]}},containerDetail:{show:!1,expand:!1,data:{containerID:"#257",containerType:{txt:"16oz 玻璃杯",code:1},reuseTime:24,status:"使用中",bindedUser:"0921-**-931",joinedDate:1234,history:[{tradeTime:1234,action:"借出",newUser:"0921-***-931",oriUser:"特有種商行(小衛)",comment:""}]}},delivery:{show:!1},deliveryDetail:{show:!1,expand:!1}}});(o.app=g).navClickListener(l)}!function(o){var s=null;function i(t,i,e){s&&s.abort(),e||(e={});var r=e.daemon||!1;r||a();var n="/manager/data/"+t;console.log(n),s=$.ajax(n,{headers:{Accept:"application/json; charset=utf-8"},dataType:"json"}).done(function(t,e,n){r||l(),i(t)}).fail(function(t,e,n){if(t.responseJSON&&"B005"===t.responseJSON.code)return o.location.href=$("#logout").attr("href");var i;r||l(),"abort"!==t.statusText&&(i="["+t.status+"]: "+(t.responseJSON?t.responseJSON.message:t.statusText||"Unknown ERR"),document.querySelector("#toast").MaterialSnackbar.showSnackbar({message:i,timeout:4e3}))}).always(function(){s=null})}function a(){app.loading.txt="Loading...",app.loading.show=!0}function l(){app.loading.show=!1,app.loading.txt=""}o.test=!1,o.requestData=function(t,e,n){return o.test?function(t,e,n){s&&clearTimeout(s),a();var i="/manager/data/"+t;console.log(i),s=setTimeout(function(){s=null,l(),e()},500)}(t,e):i(t,e,n)}}(window),$(window).on("load",function(){"/manager/login"!==window.location.pathname&&($("#loading_main").css("display","none"),appInit(window))});
//# sourceMappingURL=source-maps/app.min.js.map
