function debounce(i,n){var r=null;return function(){var t=this,e=arguments;clearTimeout(r),r=setTimeout(function(){i.apply(t,e)},n)}}function appInit(s){var a=null,o=(s.location.hash||"#index").replace("#","");$("#"+o).get(0)||(o=index);var l=null,u={shop:"店鋪",user:"使用者",container:"容器"},n=null,t=function(t,e){switch(isNaN(t)&&(t=0),e){case"withArrow":return"("+(0<=t?'<i class="material-icons" role="presentation">arrow_upward</i>':'<i class="material-icons" role="presentation">arrow_downward</i>')+parseFloat(100*Math.abs(t)).toFixed(1)+"%)";case"withoutParentheses":return parseFloat(100*t).toFixed(1)+"%";default:return"("+parseFloat(100*t).toFixed(1)+"%)"}},c=function(t){var e=$("#"+t).find("tbody").get(0);if(e){var i=e.getBoundingClientRect(),n="user-detail"!==t?48:65,r=Math.floor((s.innerHeight-i.top-44)/n);return 5<r?r:5}},e=function(t){return r.searchRegExp?"user"===o?t.id.match(r.searchRegExp):"shop"===o?t.storeName.match(r.searchRegExp):void 0:t},i={get:function(t){return this[t]?this[t]:this.number},string:function(t,e){if(t=t[r.listRendering.keyToSort].toLowerCase(),e=e[r.listRendering.keyToSort].toLowerCase(),r.listRendering.sortDir){if(t<e)return 1;if(e<t)return-1}else{if(t<e)return-1;if(e<t)return 1}return 0},number:function(t,e){return r.listRendering.sortDir?e[r.listRendering.keyToSort]-t[r.listRendering.keyToSort]:t[r.listRendering.keyToSort]-e[r.listRendering.keyToSort]},numberString:function(t,e){try{return t=parseInt(t[r.listRendering.keyToSort]),e=parseInt(e[r.listRendering.keyToSort]),r.listRendering.sortDir?e-t:t-e}catch(t){return 1}},serial:function(t,e){return t=parseInt(t[r.listRendering.keyToSort].slice(1)),e=parseInt(e[r.listRendering.keyToSort].slice(1)),r.listRendering.sortDir?e-t:t-e},time:function(t,e){return t=new Date(t[r.listRendering.keyToSort]),e=new Date(e[r.listRendering.keyToSort]),r.listRendering.sortDir?e-t:t-e}},h=function(t){var e=$("#"+t).find(".table-page-switcher");e.length?(e.get(0).focus(),e.each(function(){$(this).keyup(function(t){"ArrowLeft"===t.key?r.flipPage("last"):"ArrowRight"===t.key&&r.flipPage("next")})})):$(s).off("resize")},d=function(){$(".searchbar-field .mdl-textfield__input").val("").blur().parent().removeClass("is-focused").removeClass("is-dirty"),r.search.txt=""},g=function(t,e){var i={baseIndex:1,sortDir:null,keyToSort:null};e&&Object.assign(i,e),Object.assign(t.listRendering,i),n=null},r=new Vue({el:"#app",mounted:function(){this[o].show=!0;var t=this;$(s).resize(debounce(function(){$("#"+o).find(".table-page-switcher").length&&(t.listRendering.rawCapacity=c(o+(t.detailIsOpen?"-detail":"")))},500))},filters:{numberWithCommas:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},numberToPercentage:t,durationToString:function(t){return isNaN(t)?t:(e=moment.duration(t),n="",r=function(t,e){n+=(2==++i?" ":"")+t+" "+e},(i=0)!==e.get("Y")&&r(e.get("Y"),"年"),0!==e.get("M")&&r(e.get("M"),"個月"),2==i||(0!==e.get("d")&&r(e.get("d"),"天"),2==i||(0!==e.get("h")&&r(e.get("h"),"小時"),2==i||(0!==e.get("m")&&r(e.get("m"),"分鐘"),""===n&&(n+="0")))),n);var e,i,n,r},dateToString:function(t,e){if("尚未歸還"===t)return t;var i=moment(t);if(!i.isValid())return t;switch(e){case"only_date":return i.format("YYYY-MM-DD");case"with_day":return i.format("YYYY-MM-DD (ddd) HH:mm");default:return i.format("YYYY-MM-DD HH:mm")}}},methods:{navClickListener:function(e){var i=this;(a||o+"Detail"in this)&&(this[a||o+"Detail"].show=!1),d(),$(".mdl-layout__obfuscator.is-visible").click(),requestData(e,function(t){i[o].show=!1,i[e].show=!0,l=null,g(i),o=e,i.search.placeholder=u[o]?"在「"+u[o]+"」中搜尋":"搜尋",$("main").scrollTop(0),i.$nextTick(function(){componentHandler.upgradeDom(),h(o),i.listRendering.rawCapacity=c(o),test||(i[e].data=t)})})},aRecordClickListener:function(e,t){var i=this,n=e+"Detail";requestData(n+"?id="+t,function(t){a&&(i[a].show=!1),i[n].show=!0,a=n,l=i.listRendering.baseIndex,g(i),d(),$("main").scrollTop(0),i.$nextTick(function(){i.listRendering.rawCapacity=c(e+"-detail"),test||(i[a].data=t)})})},closeDetail:function(){d(),this[a||o+"Detail"].show=!1,g(this,{baseIndex:l||1}),this[a||o+"Detail"].data.history=[],this.listRendering.rawCapacity=c(o),a=null},sortList:function(t,e){null==this.listRendering.sortDir?this.listRendering.sortDir=!0:t===this.listRendering.keyToSort&&(this.listRendering.sortDir=!this.listRendering.sortDir),this.listRendering.keyToSort=t,n=void 0===e?"number":e,this.listRendering.baseIndex=1},showKeySorting:function(t,e){return e===this.listRendering.keyToSort&&(t+=this.listRendering.sortDir?'<i class="material-icons" role="presentation">arrow_drop_down</i>':'<i class="material-icons" role="presentation">arrow_drop_up</i>'),t},flipPage:function(t){var e;e=this.detailIsOpen?this[o+"Detail"].data.history.length:this[o+"List"].length;var i=Math.ceil(e/this.listRendering.rawCapacity);switch(t){case"next":this.listRendering.baseIndex=Math.min(this.listRendering.baseIndex+1,i);break;case"last":this.listRendering.baseIndex=Math.max(this.listRendering.baseIndex-1,1)}},searchData:function(){var e=this,t=this.search.txt;if(!(t.length<1)){var i="search?txt="+t;if("index"===o)i+="&fields=shop,user,container";else{if("container"!==o)return;i+="&fields=container"}requestData(i,function(t){e[a="search"].show=!0,test||(e[a].data=t),$("main").scrollTop(0)})}},aSearchResultClickListener:function(i,t){var n=this,r=i+"Detail";-1!==t&&requestData(r+"?id="+t,function(t){for(var e in n.search.show=!1,n.search.data)n.search.data[e].list=[];n[o].show=!1,n[i].show=!0,o=i,l=null,g(n),n.search.placeholder=u[o]?"在「"+u[o]+"」中搜尋":"搜尋",n[r].show=!0,a=r,d(),$("main").scrollTop(0),n.$nextTick(function(){componentHandler.upgradeDom(),h(o),n.listRendering.rawCapacity=c(o),test||(n[a].data=t)}),test||requestData(i,function(t){n[i].data=t},{daemon:!0})})},listMatchCtx:function(t){return this.searchRegExp?t.replace(this.searchRegExp,"<strong>$&</strong>"):t},numberToPercentage:t},computed:{detailIsOpen:function(){return this.search.show||this.shopDetail.show||this.userDetail.show||this.containerDetail.show||this.deliveryDetail.show},searchRegExp:function(){if(!(0<this.search.txt.length))return null;this.listRendering.baseIndex=1;var t=this.search.txt.split(" ").filter(function(t){return""!==t});t.forEach(function(t,e,i){1<t.length&&(i[e]=t.split("").join("-*"))});var e=t.join("|");try{return new RegExp(e,"gi")}catch(t){return null}},shopList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.shop.data.list.filter(e):this.shop.data.list.filter(e).sort(i.get(n))},shopDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.shopDetail.data.history.sort(i.get(n)):this.shopDetail.data.history},userList:function(){return null===this.listRendering.keyToSort||this.detailIsOpen?this.user.data.list.filter(e):this.user.data.list.filter(e).sort(i.get(n))},userDetailHistory:function(){if(null!==this.listRendering.keyToSort&&this.detailIsOpen){var t=this.userDetail.data.history.map(function(t){return t.returnTime}).lastIndexOf("尚未歸還")+1;return"returnTime"!==this.listRendering.keyToSort?this.userDetail.data.history.slice(0,t).sort(i.get(n)).concat(this.userDetail.data.history.slice(t).sort(i.get(n))):this.userDetail.data.history.slice(0,t).concat(this.userDetail.data.history.slice(t).sort(i.get(n)))}return this.userDetail.data.history},containerDetailHistory:function(){return null!==this.listRendering.keyToSort&&this.detailIsOpen?this.containerDetail.data.history.sort(i.get(n)):this.containerDetail.data.history}},data:{loading:{show:!1,txt:"載入中..."},listRendering:{baseIndex:1,rawCapacity:1,keyToSort:null,sortDir:null},index:{show:!1,data:{summary:{userAmount:824,storeAmount:18,activityAmount:62},activityHistorySummary:{usedAmount:16774,lostAmount:135,totalDuration:12314},shopHistorySummary:{usedAmount:6487,lostAmount:248,totalDuration:57563433659,quantityOfBorrowingFromDiffPlace:796},shopRecentHistorySummary:{usedAmount:87,lostAmount:3,totalDuration:111013967,quantityOfBorrowingFromDiffPlace:23}}},search:{show:!1,txt:"",placeholder:"搜尋",data:{user:{show:!0,list:[{id:"0936033091",name:"0936-033-091"}]},container:{show:!0,list:[{id:17,name:"#017　16oz 杯子",type:0}]},shop:{show:!0,list:[{id:0,name:"布萊恩紅茶"}]},delivery:{show:!0,list:[]}}},shop:{show:!1,data:{list:[]}},shopDetail:{show:!1,expand:!1,data:{storeName:"布萊恩紅茶",toUsedAmount:24,todayAmount:2,weekAmount:18,recentAmount:18,joinedDate:1234,contactNickname:"店長",contactPhone:"0988555666",recentAmountPercentage:.16,weekAverage:10,history:[]}},activity:{show:!1},user:{show:!1,data:{totalUserAmount:0,totalUsageAmount:0,weeklyAverageUsage:0,totalLostAmount:0,list:[]}},userDetail:{show:!1,expand:!1,data:{userPhone:"0936-003-091",usingAmount:3,lostAmount:23,totalUsageAmount:200,joinedDate:1234,joinedMethod:"店鋪 (方糖咖啡)",recentAmount:18,recentAmountPercentage:.16,weekAverage:10,averageUsingDuration:12e5,amountOfBorrowingFromDiffPlace:43,history:[]}},container:{show:!1,data:{list:[]}},containerDetail:{show:!1,expand:!1,data:{containerID:"#257",containerType:{txt:"16oz 玻璃杯",code:1},reuseTime:24,status:"使用中",bindedUser:"0921-**-931",joinedDate:1234,history:[]}},delivery:{show:!1},deliveryDetail:{show:!1,expand:!1}}});(s.app=r).navClickListener(o)}!function(s){var a=null;function n(t,n,e){a&&a.abort(),e||(e={});var r=e.daemon||!1;r||o();var i="/manager/data/"+t;console.log(i),a=$.ajax(i,{headers:{Accept:"application/json; charset=utf-8"},dataType:"json"}).done(function(t,e,i){r||l(),n(t)}).fail(function(t,e,i){if(t.responseJSON&&"B005"===t.responseJSON.code)return s.location.href=$("#logout").attr("href");var n;r||l(),"abort"!==t.statusText&&(n="["+t.status+"]: "+(t.responseJSON?t.responseJSON.message:t.statusText||"Unknown ERR"),document.querySelector("#toast").MaterialSnackbar.showSnackbar({message:n,timeout:4e3}))}).always(function(){a=null})}function o(){app.loading.txt="Loading...",app.loading.show=!0}function l(){app.loading.show=!1,app.loading.txt=""}s.test=!1,s.requestData=function(t,e,i){return s.test?function(t,e,i){a&&clearTimeout(a),o();var n="/manager/data/"+t;console.log(n),a=setTimeout(function(){a=null,l(),e()},500)}(t,e):n(t,e,i)}}(window),$(window).on("load",function(){"/manager/login"!==window.location.pathname&&($("#loading_main").css("display","none"),appInit(window))});
//# sourceMappingURL=source-maps/app.min.js.map
