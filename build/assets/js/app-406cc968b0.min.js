function debounce(n,i){var s=null;return function(){var e=this,t=arguments;clearTimeout(s),s=setTimeout(function(){n.apply(e,t)},i)}}function appInit(o){var n=null,s=null,i={shop:"店鋪",user:"使用者",container:"容器"},r='<i class="material-icons" role="presentation">arrow_upward</i>',a='<i class="material-icons" role="presentation">arrow_downward</i>',l='<i class="material-icons" role="presentation">arrow_drop_down</i>',d='<i class="material-icons" role="presentation">arrow_drop_up</i>',e=function(e,t){switch(isNaN(e)&&(e=0),t){case"withArrow":return"("+(0<=e?r:a)+parseFloat(100*Math.abs(e)).toFixed(1)+"%)";case"withoutParentheses":return parseFloat(100*e).toFixed(1)+"%";default:return"("+parseFloat(100*e).toFixed(1)+"%)"}},t=function(e){var t=$("#"+e).find("tbody").get(0);if(t){var n,i=t.getBoundingClientRect();switch(e){case"user-detail":n=65;break;case"delivery":n=56;break;default:n=48}var s=Math.floor((o.innerHeight-i.top-44-$("main").scrollTop())/n);return 5<s?s:5}},c=function(){if(null!==w.showed){if("shopDetail"===w.showed)return D.shopDetail.data.history.length;if("userDetail"===w.showed)return D.userDetail.data.history.length;if("containerDetail"===w.showed)return D.containerDetail.data.history.length}else{if("shop"===m.active)return D.shop.data.list.length;if("user"===m.active)return D.user.data.list.length;if("container"===m.active)return D.container.data.list.length;if("delivery"===m.active)return D.delivery.data.list.length}return-1},u=function(e){return D.searchRegExp?"user"===m.active?e.id.match(D.searchRegExp):"shop"===m.active?e.storeName.match(D.searchRegExp):void 0:e},h={get:function(e){return this[e]?this[e]:this.number},string:function(e,t){if(e=e[D.listRendering.keyToSort].toLowerCase(),t=t[D.listRendering.keyToSort].toLowerCase(),D.listRendering.sortDir){if(e<t)return 1;if(t<e)return-1}else{if(e<t)return-1;if(t<e)return 1}return 0},number:function(e,t){return D.listRendering.sortDir?t[D.listRendering.keyToSort]-e[D.listRendering.keyToSort]:e[D.listRendering.keyToSort]-t[D.listRendering.keyToSort]},numberString:function(e,t){try{return e=parseInt(e[D.listRendering.keyToSort]),t=parseInt(t[D.listRendering.keyToSort]),D.listRendering.sortDir?t-e:e-t}catch(e){return 1}},serial:function(e,t){return e=parseInt(e[D.listRendering.keyToSort].slice(1)),t=parseInt(t[D.listRendering.keyToSort].slice(1)),D.listRendering.sortDir?t-e:e-t},time:function(e,t){return e=new Date(e[D.listRendering.keyToSort]),t=new Date(t[D.listRendering.keyToSort]),D.listRendering.sortDir?t-e:e-t}},g=function(){if(D.detailIsOpen){var e=w.showed.slice(0,w.showed.indexOf("Detail"))+"-detail";t=$("#"+e+" .table-page-switcher")}else var t=$(".table-page-switcher");t.length&&(t.focus(),t.off("keyup"),t.keyup(function(e){"ArrowLeft"===e.key?D.flipPage("last"):"ArrowRight"===e.key&&D.flipPage("next")}))},f=function(){$(".searchbar-field .mdl-textfield__input").val("").parent().removeClass("is-focused").removeClass("is-dirty"),D.search.txt=""},p=function(e){var t={baseIndex:1,sortDir:null,keyToSort:null};e&&Object.assign(t,e),Object.assign(D.listRendering,t),n=null},m={showed:null,get active(){return this.showed},open:function(t,e,n){t in D&&(null!==this.showed&&this.close(),D[t].show=!0,s=null,p(),D.search.placeholder=i[t]?"在「"+i[t]+"」中搜尋":"搜尋",n?test||requestData(t,function(e){D[t].data=e},{daemon:!0}):($("main").scrollTop(0),test||(D[t].data=e),D.$nextTick(function(){componentHandler.upgradeDom(),g()})),this.showed=t)},close:function(){var e=this.showed;null!==e&&(D[e].show=!1,this.showed=null)}},w={showed:null,open:function(e,t){e in D&&(null!==this.showed&&this.close(),D[e].show=!0,test||(D[e].data=t),"search"===e?D.$nextTick(function(){componentHandler.upgradeDom(),g()}):D.$nextTick(function(){setTimeout(function(){componentHandler.upgradeDom(),g()},600)}),this.showed=e,$("main").scrollTop(0))},close:function(){var e=this.showed;if(null!==e){if("search"===e){for(var t in D.search.data)D.search.data[t].list=[];D.search.show=!1}else D[e].data.history=[],D[e].show=!1;this.showed=null,D.$nextTick(function(){setTimeout(function(){g()},600)})}}},y={ele:$("dialog.dialog"),nowClass:"dialog--step_one",get nowActiveClass(){return this.nowClass},classDict:{stepOne:"dialog--step_one",stepTwo:"dialog--step_two",edit:"dialog--edit"},changeClass:function(e){if(!this.classDict[e])throw new Error("Dialog has No such Class!");this.ele.removeClass(this.nowClass),this.ele.addClass(this.classDict[e])},open:function(e){return void 0!==e&&this.changeClass(e),this.ele.showModal()},close:function(){return this.ele.close()}},v={eleHtml:null,showedElement:null,showedDelivery:null,dataIndex:-1,init:function(){var e=$("#delivery_detail");this.eleHtml=e.html(),e.remove()},open:function(e,t){var n=$("#detail tbody tr:nth-child("+e+")");0!==n.length&&(null!==this.showedElement&&this.close(),n.addClass("hide-border-bottom"),n.after(this.eleHtml),this.showedElement=$("#delivery_detail"),this.showedDelivery=n,this.dataIndex=t)},close:function(){null!==this.showedElement&&(this.showedElement.remove(),this.showedElement=null,this.showedDelivery.removeClass("hide-border-bottom"),this.dataIndex=-1)}};Vue.component("delivery-detail-component",{template:"#delivery_detail_component"});var D=new Vue({el:"#app",mounted:function(){var e=this;$(o).resize(debounce(function(){$("table").length&&(e.listRendering.rawCapacity=t(m.active+(e.detailIsOpen?"-detail":"")),e.listRendering.dataLength=c(),e.$nextTick(function(){componentHandler.upgradeDom()}))},500))},updated:function(){this.listRendering.rawCapacity=t(m.active+(this.detailIsOpen?"-detail":"")),this.listRendering.dataLength=c(),this.$nextTick(function(){componentHandler.upgradeDom()})},filters:{numberWithCommas:function(e){return"number"!=typeof e?"0":e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},numberToPercentage:e,durationToString:function(e){return isNaN(e)?e:(t=moment.duration(e),i="",s=function(e,t){i+=(2==++n?" ":"")+e+" "+t},(n=0)!==t.get("Y")&&s(t.get("Y"),"年"),0!==t.get("M")&&s(t.get("M"),"個月"),2==n||(0!==t.get("d")&&s(t.get("d"),"天"),2==n||(0!==t.get("h")&&s(t.get("h"),"小時"),2==n||(0!==t.get("m")&&s(t.get("m"),"分鐘"),""===i&&(i+="0")))),i);var t,n,i,s},dateToString:function(e,t){if("尚未歸還"===e)return e;var n=moment(e);if(!n.isValid())return e;switch(t){case"only_date":return n.format("YYYY-MM-DD");case"with_day":return n.format("YYYY-MM-DD (ddd) HH:mm");default:return n.format("YYYY-MM-DD HH:mm")}}},methods:{navClickListener:function(t){f(),$(".mdl-layout__obfuscator.is-visible").click(),requestData(t,function(e){w.close(),m.open(t,e)})},aRecordClickListener:function(e,t){var n=this,i=e+"Detail";requestData(i+"?id="+t,function(e){w.open(i,e),s=n.listRendering.baseIndex,f(),p()})},aRefreshButtonClickListener:function(e){requestData("refresh/"+e,function(e){"object"==typeof e&&(e="Done"),o.showToast(e)},{method:"PATCH"})},closeDetail:function(){w.close(),f(),p({baseIndex:s||1})},searchData:function(){var e=this.search.txt;if(!(e.length<1)){var t="search?txt="+e;if("index"===m.active)t+="&fields=shop,user,container";else{if("container"!==m.active)return;t+="&fields=container"}requestData(t,function(e){w.open("search",e)})}},aSearchResultClickListener:function(t,e){var n=t+"Detail";-1!==e&&requestData(n+"?id="+e,function(e){w.open(n,e),m.open(t,e,!0),f()})},sortList:function(e,t){null==this.listRendering.sortDir?this.listRendering.sortDir=!0:e===this.listRendering.keyToSort&&(this.listRendering.sortDir=!this.listRendering.sortDir),this.listRendering.keyToSort=e,n=void 0===t?"number":t,this.listRendering.baseIndex=1},showKeySorting:function(e,t){return t===this.listRendering.keyToSort&&(e+=this.listRendering.sortDir?l:d),e},flipPage:function(e){var t=Math.ceil(this.listRendering.dataLength/this.listRendering.rawCapacity);switch(e){case"next":this.listRendering.baseIndex=Math.min(this.listRendering.baseIndex+1,t);break;case"last":this.listRendering.baseIndex=Math.max(this.listRendering.baseIndex-1,1)}},listMatchCtx:function(e){return this.searchRegExp?e.replace(this.searchRegExp,"<strong>$&</strong>"):e},numberToPercentage:e,openDialog:function(e){return y.open(e)},flipDialogPage:function(e){return y.changeClass(e)},closeDialog:function(){return y.close()},openDeliveryDetail:function(e,t){return v.open(e,t)}},computed:{detailIsOpen:function(){return this.search.show||this.shopDetail.show||this.userDetail.show||this.containerDetail.show},searchRegExp:function(){if(!(0<this.search.txt.length))return null;this.listRendering.baseIndex=1;var e=this.search.txt.split(" ").filter(function(e){return""!==e});e.forEach(function(e,t,n){1<e.length&&(n[t]=e.split("").join("-*"))});var t=e.join("|");try{return new RegExp(t,"gi")}catch(e){return null}},shopList:function(){var e=this.shop.data.list.filter(u);return null===this.listRendering.keyToSort||this.detailIsOpen||(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},shopDetailHistory:function(){var e=this.shopDetail.data.history;return null!==this.listRendering.keyToSort&&this.detailIsOpen&&(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},userList:function(){var e=this.user.data.list.filter(u);return null===this.listRendering.keyToSort||this.detailIsOpen||(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},userDetailHistory:function(){var e=this.userDetail.data.history;if(null!==this.listRendering.keyToSort&&this.detailIsOpen){var t=e.map(function(e){return e.returnTime}).lastIndexOf("尚未歸還")+1;e="returnTime"!==this.listRendering.keyToSort?e.slice(0,t).sort(h.get(n)).concat(e.slice(t).sort(h.get(n))):e.slice(0,t).concat(e.slice(t).sort(h.get(n)))}return e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},containerList:function(){var e=this.container.data.list;return null===this.listRendering.keyToSort||this.detailIsOpen||(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},containerDetailHistory:function(){var e=this.containerDetail.data.history;return null!==this.listRendering.keyToSort&&this.detailIsOpen&&(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},deliveryList:function(){var e=this.delivery.data.list;return null===this.listRendering.keyToSort||this.detailIsOpen||(e=e.sort(h.get(n))),e.slice(this.listRendering_cpt.startIndex,this.listRendering_cpt.endIndex)},listRendering_cpt:function(){return{startIndex:(this.listRendering.baseIndex-1)*this.listRendering.rawCapacity,endIndex:this.listRendering.baseIndex*this.listRendering.rawCapacity}}},data:{loading:{show:!1,txt:"載入中..."},listRendering:{baseIndex:1,rawCapacity:1,dataLength:-1,keyToSort:null,sortDir:null},index:{show:!1,data:{summary:{userAmount:824,storeAmount:18,activityAmount:62},activityHistorySummary:{usedAmount:16774,lostAmount:135,totalDuration:12314},shopRecentHistorySummary:{usedAmount:87,customerLostAmount:3,totalDuration:111013967,quantityOfBorrowingFromDiffPlace:23},shopHistorySummary:{usedAmount:6487,shopLostAmount:248,customerLostAmount:248,totalDuration:57563433659,quantityOfBorrowingFromDiffPlace:796}}},search:{show:!1,txt:"",placeholder:"搜尋",data:{user:{show:!0,list:[{id:"0936033091",name:"0936-033-091"}]},container:{show:!0,list:[{id:17,name:"#017　16oz 杯子",type:0}]},shop:{show:!0,list:[{id:0,name:"布萊恩紅茶"}]},delivery:{show:!0,list:[]}}},shop:{show:!1,data:{list:[]}},shopDetail:{show:!1,expand:!1,data:{storeName:"布萊恩紅茶",toUsedAmount:24,todayAmount:2,weekAmount:18,recentAmount:18,joinedDate:1234,contactNickname:"店長",contactPhone:"0988555666",recentAmountPercentage:.16,weekAverage:10,history:[]}},activity:{show:!1},user:{show:!1,data:{totalUserAmount:0,totalUsageAmount:0,weeklyAverageUsage:0,totalLostAmount:0,list:[]}},userDetail:{show:!1,expand:!1,data:{userPhone:"0936-003-091",usingAmount:3,lostAmount:23,totalUsageAmount:200,joinedDate:1234,joinedMethod:"店鋪 (方糖咖啡)",recentAmount:18,recentAmountPercentage:.16,weekAverage:10,averageUsingDuration:12e5,amountOfBorrowingFromDiffPlace:43,history:[]}},container:{show:!1,data:{list:[]}},containerDetail:{show:!1,expand:!1,data:{containerID:"#257",containerType:{txt:"16oz 玻璃杯",code:1},reuseTime:24,status:"使用中",bindedUser:"0921-**-931",joinedDate:1234,history:[]}},delivery:{show:!1,data:{list:[{boxAmount:4,deliveryDate:23132131,toBox:-1,toDelivery:-1,toSign:4,signed:-2,warning:-2,expand:!1,boxList:[{boxName:"Box1",contentList:[{contentName:"12oz 360ml",contentCode:1,amount:6}]}]},{boxAmount:4,deliveryDate:23132131,toBox:-1,toDelivery:-1,toSign:4,signed:-2,warning:-2,expand:!0,boxList:[{boxName:"大密封箱",contentList:[{contentName:"12oz 360ml",contentCode:1,amount:6}]}]}]}},console:{show:!1,data:null}}});o.app=D,m.showed=(o.location.hash||"#index").replace("#",""),m.showed in D||(m.showed="index"),D.navClickListener(m.active)}!function(r){var a=null;function l(){app.loading.txt="Loading...",app.loading.show=!0}function d(){app.loading.show=!1,app.loading.txt=""}function c(e){document.querySelector("#toast").MaterialSnackbar.showSnackbar({message:e,timeout:4e3})}r.test=!1,r.requestData=function(e,t,n){return r.test?(i=t,a&&clearTimeout(a),l(),void(a=setTimeout(function(){a=null,d(),i()},500))):function(e,i,t){a&&a.abort(),t||(t={});var s=t.daemon||!1,n=t.method||"GET";s||l();var o="/manager/data/"+e;a=$.ajax(o,{headers:{Accept:"application/json; charset=utf-8"},dataType:"json",method:n}).done(function(e,t,n){s||d(),i(e)}).fail(function(e,t,n){if(e.responseJSON&&"B005"===e.responseJSON.code)return r.location.href=$("#logout").attr("href");if(s||d(),"abort"!==e.statusText){var i=e.responseJSON?e.responseJSON.message:e.statusText||"Unknown ERR";c("["+e.status+"]: "+i)}}).always(function(){a=null})}(e,t,n);var i},r.showToast=c}(window),$(window).on("load",function(){if("/manager/login"!==window.location.pathname){$("#loading_main").css("display","none"),appInit(window);var e=document.querySelector("dialog");e.showModal||dialogPolyfill.registerDialog(e),$(".close").click(function(){e.close()}),window.dialog=e;var i=$("#delivery_time_display"),s=$("#delivery_time_date"),o=null;i.focus(function(){if(o)o.show();else{var e=new Date;e.setDate(e.getDate()+3),(o=$("#datepicker")).datepicker({language:"zh",startDate:e,minDate:new Date,dateFormat:"mm / dd ( D )",autoClose:!0,inline:!1,onSelect:function(e,t,n){i.val(e),s.val(t),o.hide()}})}})}});
//# sourceMappingURL=source-maps/app.min.js.map
